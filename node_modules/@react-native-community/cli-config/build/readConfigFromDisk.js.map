{"version":3,"sources":["../src/readConfigFromDisk.ts"],"names":["searchPlaces","readConfigFromDisk","rootFolder","explorer","stopDir","searchResult","searchSync","config","undefined","result","schema","projectConfig","validate","error","JoiError","value","readDependencyConfigFromDisk","dependencyName","emptyDependencyConfig","dependencyConfig","abortEarly","validationError","logger","warn","chalk","bold","message","dependency","platforms","commands"],"mappings":";;;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;;AACA;;AAKA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;;;;;AAEA;AACA;AACA;AACA,MAAMA,YAAY,GAAG,CAAC,wBAAD,CAArB;AAEA;AACA;AACA;AACA;;AACO,SAASC,kBAAT,CAA4BC,UAA5B,EAA4D;AACjE,QAAMC,QAAQ,GAAG,4BAAY,cAAZ,EAA4B;AAC3CH,IAAAA,YAD2C;AAE3CI,IAAAA,OAAO,EAAEF;AAFkC,GAA5B,CAAjB;AAKA,QAAMG,YAAY,GAAGF,QAAQ,CAACG,UAAT,CAAoBJ,UAApB,CAArB;AACA,QAAMK,MAAM,GAAGF,YAAY,GAAGA,YAAY,CAACE,MAAhB,GAAyBC,SAApD;AACA,QAAMC,MAAM,GAAGC,MAAM,CAACC,aAAP,CAAqBC,QAArB,CAA8BL,MAA9B,CAAf;;AAEA,MAAIE,MAAM,CAACI,KAAX,EAAkB;AAChB,UAAM,IAAIC,gBAAJ,CAAaL,MAAM,CAACI,KAApB,CAAN;AACD;;AAED,SAAOJ,MAAM,CAACM,KAAd;AACD;AAED;AACA;AACA;AACA;;;AACO,SAASC,4BAAT,CACLd,UADK,EAELe,cAFK,EAGiB;AACtB,QAAMd,QAAQ,GAAG,4BAAY,cAAZ,EAA4B;AAC3CC,IAAAA,OAAO,EAAEF,UADkC;AAE3CF,IAAAA;AAF2C,GAA5B,CAAjB;AAKA,QAAMK,YAAY,GAAGF,QAAQ,CAACG,UAAT,CAAoBJ,UAApB,CAArB;AACA,QAAMK,MAAM,GAAGF,YAAY,GAAGA,YAAY,CAACE,MAAhB,GAAyBW,qBAApD;AAEA,QAAMT,MAAM,GAAGC,MAAM,CAACS,gBAAP,CAAwBP,QAAxB,CAAiCL,MAAjC,EAAyC;AAACa,IAAAA,UAAU,EAAE;AAAb,GAAzC,CAAf;;AAEA,MAAIX,MAAM,CAACI,KAAX,EAAkB;AAChB,UAAMQ,eAAe,GAAG,IAAIP,gBAAJ,CAAaL,MAAM,CAACI,KAApB,CAAxB;;AACAS,uBAAOC,IAAP,CACE,8BAAc;AACpB,kBAAkBC,iBAAMC,IAAN,CACRR,cADQ,CAER,oCAAmCO,iBAAMC,IAAN,CACrCJ,eAAe,CAACK,OADqB,CAErC;AACR;AACA,6HAPM,CADF;AAUD;;AAED,SAAOjB,MAAM,CAACM,KAAd;AACD;;AAED,MAAMG,qBAAqB,GAAG;AAC5BS,EAAAA,UAAU,EAAE;AACVC,IAAAA,SAAS,EAAE;AADD,GADgB;AAI5BC,EAAAA,QAAQ,EAAE,EAJkB;AAK5BD,EAAAA,SAAS,EAAE;AALiB,CAA9B","sourcesContent":["import cosmiconfig from 'cosmiconfig';\nimport {JoiError} from './errors';\nimport * as schema from './schema';\nimport {\n  UserConfig,\n  UserDependencyConfig,\n} from '@react-native-community/cli-types';\nimport {logger, inlineString} from '@react-native-community/cli-tools';\nimport chalk from 'chalk';\n\n/**\n * Places to look for the configuration file.\n */\nconst searchPlaces = ['react-native.config.js'];\n\n/**\n * Reads a project configuration as defined by the user in the current\n * workspace.\n */\nexport function readConfigFromDisk(rootFolder: string): UserConfig {\n  const explorer = cosmiconfig('react-native', {\n    searchPlaces,\n    stopDir: rootFolder,\n  });\n\n  const searchResult = explorer.searchSync(rootFolder);\n  const config = searchResult ? searchResult.config : undefined;\n  const result = schema.projectConfig.validate(config);\n\n  if (result.error) {\n    throw new JoiError(result.error);\n  }\n\n  return result.value as UserConfig;\n}\n\n/**\n * Reads a dependency configuration as defined by the developer\n * inside `node_modules`.\n */\nexport function readDependencyConfigFromDisk(\n  rootFolder: string,\n  dependencyName: string,\n): UserDependencyConfig {\n  const explorer = cosmiconfig('react-native', {\n    stopDir: rootFolder,\n    searchPlaces,\n  });\n\n  const searchResult = explorer.searchSync(rootFolder);\n  const config = searchResult ? searchResult.config : emptyDependencyConfig;\n\n  const result = schema.dependencyConfig.validate(config, {abortEarly: false});\n\n  if (result.error) {\n    const validationError = new JoiError(result.error);\n    logger.warn(\n      inlineString(`\n        Package ${chalk.bold(\n          dependencyName,\n        )} contains invalid configuration: ${chalk.bold(\n        validationError.message,\n      )}.\n      \n      Please verify it's properly linked using \"react-native config\" command and contact the package maintainers about this.`),\n    );\n  }\n\n  return result.value as UserDependencyConfig;\n}\n\nconst emptyDependencyConfig = {\n  dependency: {\n    platforms: {},\n  },\n  commands: [],\n  platforms: {},\n};\n"]}